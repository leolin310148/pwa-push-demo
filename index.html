<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="manifest" href="/pwa-push-demo/manifest.json" />
    <link rel="canonical" href="https://leolin310148.github.io/pwa-push-demo/" />
    <script src="https://js.pusher.com/beams/1.0/push-notifications-cdn.js"></script>

</head>
<body>

<h4>pwd push demo</h4>
<div id="message">

</div>

<script>
    const container = document.querySelector("#message");
    function log(message) {
        container.appendChild(document.createTextNode(message));
        container.appendChild(document.createElement("br"));
    }
    window.navigator.serviceWorker.ready.then(serviceWorkerRegistration => {
        log(`service worker ready `)
        console.log(`service worker ready `, serviceWorkerRegistration)
        const beamsClient = new PusherPushNotifications.Client({
            instanceId: 'f15795fb-d044-47b0-9e99-76b52a9faee6',
            serviceWorkerRegistration: serviceWorkerRegistration,
        });

        beamsClient.start()
            .then(() => beamsClient.addDeviceInterest('hello'))
            .then(() => {
                log(`pusher registered and subscribed!`)
                console.log('Successfully registered and subscribed!');
            })
            .catch(console.error);
    })

    // register ServiceWorker, remember to use absolute path!
    if (navigator.serviceWorker) {
        navigator.serviceWorker.register('/pwa-push-demo/service-worker.js', {scope: '/pwa-push-demo/'})
    }
</script>
</body>
</html>
